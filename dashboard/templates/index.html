<!DOCTYPE html>
<html>
<head>
    <title>Fraud Detection Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    {% if view == "chart" %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% endif %}
</head>
<body>

<h1>Fraud Detection Dashboard</h1>

<div class="view-switch">
    <a href="/?view=table"><button class="btn">Table View</button></a>
    <a href="/?view=chart"><button class="btn">Chart View</button></a>
</div>

<div class="stats">
    <div class="box">
        Total Transactions
        <b>{{ total }}</b>
    </div>

    <div class="box fraud">
        Fraud Transactions
        <b>{{ fraud }}</b>
    </div>

    <div class="box">
        Fraud Rate
        <b>{{ fraud_rate }}%</b>
    </div>
</div>

{% if view == "chart" %}

<div class="charts">
    <div class="chart-box">
        <h3>Fraud vs Not Fraud (Count)</h3>
        <canvas id="barChart"></canvas>
    </div>

    <div class="chart-box">
        <h3>Fraud Distribution</h3>
        <canvas id="pieChart"></canvas>
    </div>
</div>

<script>
const labels = {{ labels | tojson }};
const values = {{ values | tojson }};

const colors = [
    "#4CAF50",
    "#F44336"
];

new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: {
        labels: labels,
        datasets: [{
            label: "Number of Transactions",
            data: values,
            backgroundColor: colors
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        }
    }
});

new Chart(document.getElementById("pieChart"), {
    type: "pie",
    data: {
        labels: labels,
        datasets: [{
            label: "Transaction Distribution",
            data: values,
            backgroundColor: colors
        }]
    },
    options: {
        responsive: true
    }
});
</script>

{% else %}

<h2>Latest Transactions</h2>

<table>
    <tr>
        <th>Transaction ID</th>
        <th>Client</th>
        <th>Card</th>
        <th>Amount</th>
        <th>Prediction</th>
        <th>Time</th>
    </tr>

    {% for r in rows %}
    <tr class="{% if r[4] == 1 %}fraud-row{% endif %}">
        <td>{{ r[0] }}</td>
        <td>{{ r[1] }}</td>
        <td>{{ r[2] }}</td>
        <td>{{ r[3] }}</td>
        <td>
            {% if r[4] == 1 %}
                Fraud
            {% else %}
                Not Fraud
            {% endif %}
        </td>
        <td>{{ r[5] }}</td>
    </tr>
    {% endfor %}
</table>

{% endif %}

<script>
setTimeout(() => {
    window.location.reload();
}, 5000);
</script>

</body>
</html>
